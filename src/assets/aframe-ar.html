<!DOCTYPE html>
<html>
<script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

<body style="margin: 0px; overflow: hidden;">
    <script>
        // ---------------------------------------------------------
        // CONFIGURACIÓN: Carga dinámica desde LocalStorage
        // ---------------------------------------------------------
        const defaultTargets = [
            {
                markerType: 'hiro',
                content: { type: 'image', src: 'imagetarget.jpg' }
            },
            {
                markerType: 'kanji',
                content: { type: 'box', color: 'yellow', opacity: 0.8 }
            },
            {
                markerType: 'barcode',
                value: 5,
                content: { type: 'cylinder', color: 'green', height: 1, radius: 0.5 }
            },
            {
                markerType: 'barcode',
                value: 10,
                content: { type: 'torus', color: 'purple', radius: 0.5, animation: 'property: rotation; to: 0 360 0; loop: true; dur: 3000' }
            }
        ];

        // Intentar cargar desde la memoria del teléfono (LocalStorage)
        // Si no hay nada, usar los por defecto.
        const storedTargets = localStorage.getItem('arTargets');
        const targets = storedTargets ? JSON.parse(storedTargets) : defaultTargets;

        // ---------------------------------------------------------
        // LÓGICA: Generación Automática (No tocar)
        // ---------------------------------------------------------
        AFRAME.registerComponent('scene-generator', {
            init: function () {
                const scene = this.el;
                console.log('Generando ' + targets.length + ' targets dinámicamente...');

                targets.forEach(target => {
                    let marker;

                    // 1. Crear el Marcador
                    if (target.markerType === 'barcode') {
                        marker = document.createElement('a-marker');
                        marker.setAttribute('type', 'barcode');
                        marker.setAttribute('value', target.value);
                    } else {
                        marker = document.createElement('a-marker');
                        marker.setAttribute('preset', target.markerType);
                    }

                    // 2. Crear el Contenido
                    let contentElement;
                    const c = target.content;

                    if (c.type === 'image') {
                        contentElement = document.createElement('a-image');
                        contentElement.setAttribute('src', c.src);
                        contentElement.setAttribute('rotation', '-90 0 0');
                        contentElement.setAttribute('width', '2');
                        contentElement.setAttribute('height', '2');
                    } else {
                        // Para figuras geométricas (box, sphere, cylinder, etc)
                        contentElement = document.createElement('a-' + c.type);
                        contentElement.setAttribute('position', '0 0.5 0');

                        // Asignar atributos dinámicamente (color, radius, etc)
                        Object.keys(c).forEach(key => {
                            if (key !== 'type') {
                                if (key === 'animation') {
                                    contentElement.setAttribute('animation', c[key]);
                                } else if (key === 'material') {
                                    contentElement.setAttribute('material', c[key]);
                                } else {
                                    contentElement.setAttribute(key, c[key]);
                                }
                            }
                        });
                    }

                    // 3. Unir y agregar a la escena
                    marker.appendChild(contentElement);
                    scene.appendChild(marker);
                });
            }
        });
    </script>

    <a-scene embedded scene-generator
        arjs='sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3; sourceWidth:1280; sourceHeight:960; displayWidth: 1280; displayHeight: 960;'>
        <a-entity camera></a-entity>
    </a-scene>
</body>

</html>