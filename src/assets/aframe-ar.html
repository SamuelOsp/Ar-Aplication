<!DOCTYPE html>
<html>
<script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

<body style="margin: 0px; overflow: hidden;">
    <!-- On-screen Debug Console -->
    <div id="debug-console"
        style="position: fixed; top: 10px; left: 10px; background: rgba(0,0,0,0.7); color: lime; padding: 10px; font-family: monospace; z-index: 9999; pointer-events: none;">
        Initializing...
    </div>

    <script>
        function log(msg) {
            const consoleDiv = document.getElementById('debug-console');
            consoleDiv.innerHTML += '<br>' + msg;
            console.log(msg);
        }

        AFRAME.registerComponent('dynamic-content', {
            init: function () {
                const params = new URLSearchParams(window.location.search);
                const type = params.get('type') || 'box';
                const marker = this.el;

                log('Init. Type: ' + type);

                // Marker Events
                marker.addEventListener('markerFound', function () {
                    log('SUCCESS: Marker Found!');
                });
                marker.addEventListener('markerLost', function () {
                    log('Status: Marker Lost');
                });

                let content;
                if (type === 'box') {
                    content = document.createElement('a-box');
                    content.setAttribute('position', '0 0.5 0');
                    content.setAttribute('material', 'color: red; opacity: 0.8;');
                    content.setAttribute('scale', '0.5 0.5 0.5');
                } else if (type === 'sphere') {
                    content = document.createElement('a-sphere');
                    content.setAttribute('position', '0 0.5 0');
                    content.setAttribute('radius', '0.5');
                    content.setAttribute('material', 'color: blue; opacity: 0.8;');
                } else if (type === 'image') {
                    content = document.createElement('a-image');
                    content.setAttribute('src', 'imagetarget.jpg');
                    content.setAttribute('rotation', '-90 0 0');
                    content.setAttribute('width', '2');
                    content.setAttribute('height', '2');
                }

                if (content) {
                    log('Content created: ' + content.tagName);
                    marker.appendChild(content);
                } else {
                    log('ERROR: No content for type ' + type);
                }
            }
        });
    </script>
    <a-scene embedded
        arjs='sourceType: webcam; debugUIEnabled: false; sourceWidth:1280; sourceHeight:960; displayWidth: 1280; displayHeight: 960;'>
        <a-marker preset="hiro" dynamic-content>
            <!-- Debug Border: Yellow Ring -->
            <a-ring radius-inner="1" radius-outer="1.1" color="yellow" rotation="-90 0 0"></a-ring>
            <!-- Content injected via JS -->
        </a-marker>
        <a-entity camera></a-entity>
    </a-scene>
</body>

</html>